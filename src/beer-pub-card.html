<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/iron-image/iron-image.html">
<link rel="import" href="../bower_components/iron-icon/iron-icon.html">
<link rel="import" href="../bower_components/paper-styles/element-styles/paper-material-styles.html">
<link rel="import" href="../bower_components/paper-icon-button/paper-icon-button.html">

<link rel="import" href="beer-pub-icons.html">
<link rel="import" href="beer-pub-rating.html">
<link rel="import" href="beer-pub-favorite.html">

<dom-module id="beer-pub-card">

  <template strip-whitespace>
    
    <style include="paper-material-styles">

      a{
      color: var(--app-primary-color);
      text-decoration: none;
    }

      .card{
        @apply --paper-material-elevation-1;
        margin: 10px;
      }

      .card-information{
        padding: 10px;
        margin: 10px;

      }

      .items > div{
        margin: 0 10px 10px 10px
      }


      .name {
        font-size: 1.5em;
        font-weight: 300;
        color: var(--app-primary-color);
        margin: 10px 0 0 0;
      }

      .motto {
        font-size: 1.0em;
        font-weight: 400;
        color: var(--app-primary-color);
      }

      .address {
        font-size: 1.0em;
        font-weight: 300;
        color: var(--app-primary-color);
      }
      
      .distance{
        font-size: 1.0em;
        font-weight: 300;
        color: var(--app-secondary-color);
      }

      .icons-wrapper{
        @apply --layout-horizontal;
        @apply --layout-justified;
        @apply --layout-wrap;
      }

      .sponsor-wrapper{
        font-size: .8em;
        font-weight: 300;
        color: var(--app-secondary-color);
      }





    </style>

    

      <div class="card">
     
        <template is="dom-if" if="[[sponsor]]">
          <div hidden$="[[!photoUrl]]">
          <a aria-label$="[[name]]" href$="/[[urlName]]/main?orgid=[[placeId]]">
            <iron-image 
                style="width:100%; height:300px; background-color: #F8F8F8;"
                sizing="cover" 
                preload 
                placeholder="[[_computedPlaceHolder]]"
                fade
                src="[[photoUrl]]">
            </iron-image>
           
          </a>
          </div>
        </template>
      <div class="card-information">

     
        <div  class="sponsor-wrapper" >
            <div id="sponsor" hidden$="[[sponsorHide]]">Sponsoring Organization</div>
        </div>
            <div class="rating">
              <beer-pub-rating 
                  place-id="[[placeId]]"
                  google-rating="[[googleRating]]"
                  login="{{login}}"
                  address="[[address]]"
                  name="[[name]]">
              </beer-pub-rating>
            </div>
           
           
   
         
       
          <a aria-label$="[[name]]" href$="/[[urlName]]/main?orgid=[[placeId]]">
            <div class="items">
                <div class="name">[[name]]</div>
                <template is="dom-if" if="[[sponsor]]">
                  <div class="motto">[[motto]]</div>
                </template>
                <div class="address" hidden$="[[!address]]">[[address]]</div>
                <!--<div class="address" hidden$="[[address]]">[[city]], [[state]]</div>-->
                <div class="distance" hidden$="[[!distance]]">[[_computeDisplayDistance(distance)]] miles from you</div>
            </div>
           </a>
            <div>
              <beer-pub-icons
                dogs="[[dogFriendly]]"
                patio="[[patio]]"
                over21="[[over21]]">
              </beer-pub-icons>
            </div>
           
      </div>
      </div>
 
    
  </template>

  <script>

    Polymer({

      is: 'beer-pub-card',

       properties: {

          address:{
            type: String
          },

          city:{
            type: String
          },

          distance:{
            type: Number,
            value: false
          },

          dogFriendly:{
            type: Boolean,
            value: false
          },

          googleRating:{
            type: Number
          },

          login: {
            type: Boolean,
            notify: true
          },

          motto:{
            type: String
          },

          name:{
              type: String
          },

          over21:{
            type: Boolean,
            value: false
          },

          patio:{
            type: Boolean,
            value: false
          },

          photoUrl:{
            type: String
          },

          thumbnail:{
            type: String
          },

          _computedPlaceHolder:{
            type: String,
            computed: '_computePlaceHolder(thumbnail)'
          },

          placeId:{
            type: String
          },

          sponsor:{
            type: Boolean,
            value: false
          },

          sponsorHide:{
            type: Boolean,
            computed: '_computeSponsorHide(sponsor)',
            value: true
          },

          state:{
            type: String
          },
          
          urlName:{
              type: String,
              computed: '_computeNameForUrl(name)'
          }
         
        },

        // observers: ['_watch(sponsor)'],

        //  _watchforSponsor: function (sponsor){
        
        //   if(sponsor){
        //     // console.log('sponsor', sponsor)
        //     // this.$.sponsor.hidden = false;
        //   }
        // },

         _computeDisplayDistance: function (distance){
          return Math.round(distance*10)/10
        },

        _computeSponsorHide: function (sponsor){
          if(sponsor){
            return false;
          }else{
            return true;
          }
        },

        _computeNameForUrl: function (name) {
         'use strict';
          if (name) {
            name = name.replace(/\s/g, '-')
            return name.replace(/[^a-zA-Z\d\s:]/g, '');
          } else {
            return 'pub-name-missing'
          }
      },
      _computePlaceHolder: function (thumbnail){
        if(thumbnail){
          return 'data:image/png;base64, '+thumbnail;
        }
      }

    });

  </script>

</dom-module>
