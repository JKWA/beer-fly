<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/iron-label/iron-label.html">
<link rel="import" href="../bower_components/neon-animation/animations/slide-from-right-animation.html">
<link rel="import" href="../bower_components/neon-animation/animations/slide-right-animation.html">
<link rel="import" href="../bower_components/paper-button/paper-button.html">
<link rel="import" href="../bower_components/paper-dialog/paper-dialog.html">
<link rel="import" href="../bower_components/paper-dialog-scrollable/paper-dialog-scrollable.html">
<link rel="import" href="../bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="../bower_components/paper-input/paper-input.html">
<link rel="import" href="../bower_components/paper-input/paper-textarea.html">
<link rel="import" href="../bower_components/polymerfire/firebase-auth.html">
<link rel="import" href="../bower_components/polymerfire/firebase-document.html">
<link rel="import" href="../bower_components/polymerfire/firebase-query.html">

<link rel="import" href="beer-beer-card.html">

<link rel="import" href="../my_components/data/upload-image.html">
<link rel="import" href="beer-fab.html">
<link rel="import" href="beer-banner.html">




<dom-module id="beer-beer">

 <template strip-whitespace>
    
    <style include="paper-material-styles">

     
      
      :host {
        display: block;
        max-width: 640px;
        background-color: var(--app-background-color);

      }
      

      a{
        color: var(--app-accent-color);
        text-decoration: none;
        }

        /*paper-material {
           
        }*/

      .card{
        margin: 10px;
        padding: 20px;
        @apply --paper-material-elevation-1;
        background-color: white;

      }

      .description {
        font-size: 1.2em;
        font-weight: 300;
        margin: 10px 5px 0 20px;
      }

    </style>

    <firebase-auth  app-name="beer" user="{{user}}"></firebase-auth>

    <beer-banner
      google-photo="[[place.photos]]"
      photo-index="2"
      photo="[[category.image]]"
      org-id="[[orgId]]">
    </beer-banner>
    
    <beer-fab owner="[[owner]]" on-tap="_edit"></beer-fab>

   <template is="dom-repeat" items="[[_addBreaks(category.description)]]" as="description">
      <div class="description">
          [[description]]
      </div>
   </template>

   
    <div class="card" elevation="1">
      <iron-label>
        <a aria-label$="TEST" href$="/[[nameUrl]]/beer-edit?orgid=[[orgId]]">
          <paper-icon-button icon="beer-icons:add"></paper-icon-button>
          Add a beer</a>
      </iron-label>
    </div>
  

    
    <template is="dom-repeat" items="[[_getArray(organization.brewBeer)]]" sort="_sortOrder" as="beer" filter="[[_filterBeers(owner)]]">
      <beer-beer-card 
          beer-id="[[beer.id]]"
          beer-name="[[beer.name]]"
          beer-description="[[beer.description]]"
          status="[[beer.status]]"
          brewery-name="[[place.name]]"
          brewery-city="[[organization.city]]"
          brewery-state="[[organization.stateAbbreviation]]"
          style-name="[[beer.styleName]]"
          abv="[[beer.abv]]"
          place-id="[[place.place_id]]"
          crowd-source="[[organization.crowdSource]]"
          owner="[[owner]]" 
          uid="[[user.uid]]"
          edit-beer-id="{{editBeerId}}"
          name-url="[[nameUrl]]"
          login="{{login}}">
      </beer-beer-card>
    </template>


    <paper-dialog 
        id="editDialog"
        with-backdrop
        style="width: 90vw;"
        entry-animation="slide-from-right-animation"
        exit-animation="slide-right-animation">
            
      <div> 
          <h3>[[category.title]]</h3>
      </div>
    
        <paper-dialog-scrollable>
          <upload-image org-id="[[orgId]]" type="banner" file-name="[[nameUrl]]_BEER_banner" key="category/BEER/image"></upload-image>   
          <paper-textarea label="Description" value="{{category.description}}" maxlength=2000 char-counter></paper-textarea>
        </paper-dialog-scrollable>
    
      <div>
        <paper-button dialog-dismiss autofocus>CLOSE</paper-button>
      </div>
    </paper-dialog>

  

  </template>

  <script>

    Polymer({

      is: 'beer-beer',

      properties:{

       dialogOpen:{
          type:Boolean
       },
       nameUrl:{
         type: String
       },
       
       orgId:{
         type:String
       },

       owner:{
         type: Boolean
       },
       organization:{
         type: Object
       },

       place:{
         type:Object
       },

       crowdSource:{
         type: Boolean
       },
   
       beer:{
         type: Object
       },

       login: {
         type: Boolean,
         notify: true
       },

        owner:{
          type: Boolean,
          value: false
        },

        user: {
          type: Object,
          value: function (){
            return {};
          }
        },

        editBeerId:{
          type: String
        }
        
      },
    


     _edit: function(){
        
        var body = document.querySelector('body');
          Polymer.dom(body).appendChild(this.$.editDialog);
          this.$.editDialog.open()
       
      },
      
      _addBreaks: function(str){
   
        if(str){
          return str.split('\n');
        }else{
          return [];
        }
      },

       _getArray: function(obj){

        if(obj){
          var returnArray = [];
          var key = Object.keys(obj);
          for (var i=0; i<key.length; i++){
            obj[key[i]].$key = key[i]
            returnArray.push(obj[key[i]])
          }
           return returnArray;
        }
      },

      _sortOrder: function(a,b){

        if (a.order < b.order)
          return -1;
        if (a.order > b.order)
          return 1;
        return 0;
      },

      

      _filterBeers: function (owner){
        // console.log(beer);
        return function(beer) {
          // console.log('beer',beer)
          // console.log('owner', owner)
          if(owner){
            return true;
          }else{
            if(beer.status === 'verified'){
              return true;
            }else{
              return false;
            }
          }
          return true;
        };
      },

      _test: function (obj) {
        console.log('TEST', obj);
      }

    });

  </script>

</dom-module>
