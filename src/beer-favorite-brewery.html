<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/polymerfire/firebase-auth.html">
<link rel="import" href="../bower_components/polymerfire/firebase-query.html">
<link rel="import" href="../bower_components/polymerfire/firebase-document.html">

<link rel="import" href="beer-icons.html">
<link rel="import" href="beer-pub-card.html">


<dom-module id="beer-favorite-brewery">
  

  <template strip-whitespace>
    
    <style include="paper-material-styles">

      :host {
        display: block;
        max-width: 640px;
      }

    </style>

    <firebase-auth 
        id="auth" 
        app-name="beer"
        user="{{user}}" 
        status-known="{{statusKnown}}"
        on-error="handleError">
    </firebase-auth>

    <firebase-document
        id="favorite"
        app-name="beer"
        disabled
        path="user/[[user.uid]]/favorite"
        data="{{favorite}}">
    </firebase-document>



    <template is="dom-repeat" items=[[_toArray(favorite)]] as="pub" sort="_sortByRating">
      
      <beer-pub-card 
            place-id="[[pub.place_id]]"
            name="[[pub.name]]"
            address="[[pub.vicinity]]"
            dog-friendly="[[!pub.dogFriendly]]"
            patio="[[!pub.patio]]"
            over21="[[!pub.over21]]">
      </beer-pub-card>


    </template>


  </template>
  <script>

  Polymer({

    is: 'beer-favorite-brewery',

     properties: {
        user:{
          type: Object
        },
      },

     observers:['_watchUserStatus(statusKnown)'],

    _watchUserStatus: function (statusKnown) {
      // console.log(statusKnown)
      if(statusKnown){
        this.$.favorite.disabled = false;
        
      }else{
        this.$.favorite.disabled = true;
      }
    },

  _toArray: function (obj){
    
    if(obj){
      var returnArray=[];
      var key = Object.keys(obj);
      for (var i=0; i<key.length; i++){
        var pub = obj[key[i]];
        
        pub.dogFriendly = false;
        pub.patio = false;
        pub.over21=false;
        // beer.id = key[i];
        // beer.name = obj[key[i]].name;
        // beer.rating = obj[key[i]].rating;
        returnArray.push(pub);
      }
      return returnArray.sort(this._sortByName);
    }
  },

  _sortByRating: function(a,b){
      'use strict';
      if (a.rating > b.rating)
        return -1;
      if (a.rating < b.rating)
        return 1;
      return 0;
    },
    
    _sortByName: function(a,b){
      'use strict';
      if (a.name < b.name)
        return -1;
      if (a.name > b.name)
        return 1;
      return 0;
    },
    _test: function (obj){
      console.log("RATING", obj);
    }

  });

  </script>

</dom-module>
