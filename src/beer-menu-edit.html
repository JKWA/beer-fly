<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/polymerfire/firebase-query.html">
<link rel="import" href="../bower_components/iron-label/iron-label.html">
<link rel="import" href="../bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="../bower_components/paper-card/paper-card.html">
<link rel="import" href="../bower_components/paper-checkbox/paper-checkbox.html">
<link rel="import" href="../bower_components/paper-input/paper-input.html">
<link rel="import" href="../bower_components/paper-input/paper-textarea.html">
<link rel="import" href="../bower_components/paper-item/paper-item.html">

<link rel="import" href="../bower_components/paper-listbox/paper-listbox.html">
<link rel="import" href="../bower_components/paper-material/paper-material.html">

<link rel="import" href="../bower_components/toggle-icon/toggle-icon.html">
<link rel="import" href="../bower_components/iron-collapse/iron-collapse.html">
<link rel="import" href="../my_components/data/upload-image.html">
<link rel="import" href="beer-icons.html">
<link rel="import" href="beer-button.html">
<link rel="import" href="beer-menu-edit-category.html">
<link rel="import" href="beer-menu-edit-item.html">


<dom-module id="beer-menu-edit">

  <template>

    <style>
      .add{
        color: green;
      }
      .delete{
        color:red;
        margin: 20px 0 0 0;
        width: 40px;
      }

     .actual-delete{
        background-color: red;
        color: white;
        width: 100%;
      }

      .toggle{
        font-size: 1.25em;
        font-weight: 500;
      }

      
      .menu-category{
         @apply(--layout-vertical);
         @apply(--layout-start-justified);
         /*@apply(--layout-wrap);*/
         padding: 5px;
         margin: 5px 5px 15px 5px;
      }

      .motto {
        font-size: 2.0em;
        font-weight: 500;
        margin: 40px 5px 0 20px;
      }

      .description {
        font-size: 1.2em;
        font-weight: 300;
        margin: 10px 5px 0 20px;
      }

    </style>
     <firebase-query
          id="menu"
          app-name="beer"
          path="organization/[[orgId]]/category/MENU/menu"
          data="{{menu}}">
      </firebase-query>



      <div class="menu-edit">

      <upload-image org-id="[[orgId]]" type="banner" key="category/MENU/image"></upload-image>
      <paper-input label="Motto" value="{{category.motto}}"maxlength=100 char-counter></paper-input>
      <paper-textarea label="Description" value="{{category.description}}" maxlength=2000 char-counter>
      </paper-textarea>
      
       <iron-label>
        <toggle-icon 
              animation="flip-vertical"
              class="delete" 
              icon="beer-icons:remove"
              class="menu-button"
              checked="{{toggleDeleteCategory}}"
              noink>
        </toggle-icon>
          REMOVE CATEGORY
      </iron-label>

       <template is="dom-repeat" items="{{menu}}" as="categoryItem" sort="_sortOrder" remove-whitespace>
        
         <paper-material class="menu-category"  elevation="1">
          <div >
            <iron-collapse opened={{toggleDeleteCategory}}>
              <div class="actual-delete">
                <iron-label>
                  <paper-icon-button 
                    icon="beer-icons:delete-forever" 
                    category-item-key="[[categoryItem.$key]]"
                    on-tap="_deleteMenuCategory">
                  </paper-icon-button>
                  DELETE THIS CATEGORY AND MENU ITEMS
                </iron-label>
            </div>
            </iron-collapse>

              <div>
               
                <beer-menu-edit-category 
                  category="[[categoryItem]]"
                  org-id="[[orgId]]">
                </beer-menu-edit-category>
              
                <paper-textarea 
                    class="text-input" 
                    label="Category Description" 
                    value="{{categoryItem.description}}"
                    maxlength=1000 >
                </paper-textarea>
              
                <beer-menu-edit-item 
                    org-id="[[orgId]]"
                   
                    menu-key="[[categoryItem.$key]]">
                </beer-menu-edit-item>

              </div>
          </div>
         </paper-material>
       </template>
      

       <div>
       <iron-label>
        <paper-icon-button 
            class="add" 
            icon="beer-icons:add" 
            on-tap="_addMenuCategory">
        </paper-icon-button>
        ADD CATEGORY
      </iron-label>
      </div>

      </div>
  </template>

  <script>

    Polymer({

      is: 'beer-menu-edit',

       properties: {
        toggle: {
          type: Boolean
        },
        menuCategory: {
          type: Object,
          // computed: 'computeMenuCategory()
        },
        category:{
          type: Object
        }
      },

      // observers:['_categoryChanged(category)'],

      // _categoryChanged: function (category, oldMenu){
        
      //   console.log("CHANGE", category);

      //        var menu = category.menu;
      //   if(menu){
      //     var key = Object.keys(menu);
      //     for(var i=0; i<key.length; i++){
      //       menu[key[i]].categoryName = category.name;
      //       menu[key[i]].categoryTitle = category.title;
      //       menu[key[i]].category = category.category;
      //       console.log(menu[key[i]]);
      //       // this.menuMeta.ref.child(key[i]).update(menu[key[i]]);
            
      //     }
      //   }

      // },

      _addMenuCategory: function (){
        var obj = {};
          obj.order = 10000
          obj.type = 'category';
        console.log(this.$.menu.ref.push(obj));
      },

       _deleteMenuCategory:function (e){
          var target = e.currentTarget;
          var key = target.categoryItemKey;
          this.toggleDeleteCategory = false;
          this.$.menu.ref.child(key).remove(); 
      },

     _ifValue: function(value){
        'use strict';
        if( typeof value === 'string'){
          return value;

        }else{
          return 'Select a category';
        }
    }, 
   

   _sortOrder: function(a,b){

      'use strict';
    
      if (a.order < b.order)
        return -1;
      if (a.order > b.order)
        return 1;
      return 0;
    },

    });

  </script>

</dom-module>
