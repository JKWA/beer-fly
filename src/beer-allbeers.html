<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/iron-collapse/iron-collapse.html">
<link rel="import" href="../bower_components/paper-item/paper-item.html">
<link rel="import" href="../bower_components/paper-listbox/paper-listbox.html">
<link rel="import" href="../bower_components/polymerfire/firebase-query.html">
<link rel="import" href="../bower_components/toggle-icon/toggle-icon.html">
<link rel="import" href="../bower_components/iron-icon/iron-icon.html">
<link rel="import" href="beer-allbeers-card.html">

<link rel="import" href="beer-icons.html">

<dom-module id="beer-allbeers">

  <template>

    <style>

      .category-wrapper{
        @apply(--layout-horizontal);
        color: var(--app-accent-color);
      }

      .category-shown{
        font-size: 1.5em;
        font-weight: 500;
        margin: 5px 0 0 0;
        
      }

      .category-title{
        font-size: 1em;
        font-weight: 500;
        color: var(--app-secondary-color);
        height: 10px;
      }




      @media (max-width: 767px) {
        .logo{
          visibility: hidden
        }

        h3 {
          margin: 24px 0;
        }

      }

    </style>

     <firebase-query
        app-name="beer"
        id="beers"
        disabled
        order-by-child="category"
        equal-to="{{categoryKey}}"
        path="beer"
        data="{{beers}}">
    </firebase-query>


    <firebase-query
        app-name="beer"
        path="category/STYLECATEGORY"
        data="{{categories}}">
    </firebase-query>


        <div hidden=[[!showCategory]]>
          
          <iron-label class="category-wrapper">
            <toggle-icon
                  animation="flip-vertical" 
                  icon="beer-icons:expand-more"
                  checked="{{toggle}}"
                  noink>
            </toggle-icon>
            <div class="category-shown">[[selectedCategoryDisplay]]</div>
           </iron-label>
        </div>
  
        <div> 
          <iron-collapse opened="[[toggle]]">
            <paper-listbox
                attr-for-selected="category"
                selected="{{selectedCategory}}"
                on-tap="close">

              <template is="dom-repeat" items="[[categories]]" as="category" sort="_sortByOrder">
              <paper-item  category="[[category]]">
                <div class="category-title">
                  [[category.title]]
                </div>
              </paper-item>
              </template>

            </paper-listbox>

          </iron-collapse>
        </div>
           

     <template is="dom-repeat" items="[[beers]]" as="beer" sort="_sortByBreweryName">
       <beer-allbeers-card beer="[[beer]]" org-id="[[orgId]]"></beer-allbeers-card>
     </template>
     
  </template>

  <script>

    Polymer({

      is: 'beer-allbeers',
       properties: {
  
        categoryKey: {
          type: Number,
          // value: 'PORTER'
        },

        selectedCategory:{
          type: Object
        },

        selectedCategoryDisplay:{
         type: String,
         value: 'Select Category'
        },
        showCategory:{
          type: Boolean,
          value: false
        },

        beers: {
          type: Array,
        },

        toggle:{
          type: Boolean
        }
        
       },
       
       observers: [
            '_observeSelectedCategory(selectedCategory)',
            ],

      ready: function(){
        this.showCategory = true;
        Polymer.AppLayout.scroll({ top: 0, behavior: 'silent' });
      },


     

      _observeSelectedCategory: function (selectedCategory){

        if(selectedCategory){
          this.$.beers.disabled = false;
          this.selectedCategoryDisplay = selectedCategory.title;
          this.categoryKey = selectedCategory.$key;

        }else{
          this.$.beers.disabled = true;
          this.selectedCategoryDisplay = 'Select Category';
        }

      },

      _computeSortByBreweryName: function (beers){
        console.log(beers);
        return beers.sort(this._sortByBreweryName);
      },

      _computeStyle: function (styleId){
        return Number(styleId)
      },

      _computeNameForUrl: function (name) {
         'use strict';
          if (name) {
            name = name.replace(/\s/g, '-')
            return name.replace(/[^a-zA-Z\d\s:]/g, '');
          } else {
            return 'pub-name-missing'
          }
      },

      _computeSelectedCategoryDisplay: function(selectCategory) {
        console.log('SELECT', selectCategory)
        if(selectCategory){
          return selectCategory;
        }else{
          return 'Select Category'
        } 
      },

      _sortByBreweryName: function(a,b){
        'use strict';
        if (a.breweryName < b.breweryName)
          return -1;
        if (a.breweryName > b.breweryName)
          return 1;
        return 0;
      },

      _sortByOrder: function(a,b){
        'use strict';
        if (a.order < b.order)
          return -1;
        if (a.order > b.order)
          return 1;
        return 0;
      },

       close: function (){
        this.toggle = false;
        // console.log(this.selectedCategory);
      },

    
      _test: function (obj) {
        console.log(obj);
      }

    });

  </script>

</dom-module>
