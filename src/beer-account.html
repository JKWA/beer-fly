

<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/polymerfire/firebase-document.html">
<link rel="import" href="../bower_components/iron-image/iron-image.html">
<link rel="import" href="../bower_components/iron-icon/iron-icon.html">
<link rel="import" href="../bower_components/iron-media-query/iron-media-query.html">

<link rel="import" href="../bower_components/neon-animation/animations/slide-from-right-animation.html">
<link rel="import" href="../bower_components/neon-animation/animations/slide-right-animation.html">

<link rel="import" href="../bower_components/paper-button/paper-button.html">
<link rel="import" href="../bower_components/paper-card/paper-card.html">
<link rel="import" href="../bower_components/paper-dialog/paper-dialog.html">
<link rel="import" href="../bower_components/paper-dialog-scrollable/paper-dialog-scrollable.html">
<link rel="import" href="../bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="../bower_components/paper-input/paper-input.html">
<link rel="import" href="../bower_components/paper-input/paper-textarea.html">
<link rel="import" href="../bower_components/paper-material/paper-material.html">

<link rel="import" href="../bower_components/polymerfire/firebase-auth.html">
<link rel="import" href="../bower_components/polymerfire/firebase-query.html">
<link rel="import" href="../bower_components/polymerfire/firebase-document.html">
<link rel="import" href="../my_components/data/upload-image.html">

<link rel="import" href="beer-pub-card.html">
<link rel="import" href="beer-fab.html">
<link rel="import" href="beer-button.html">
<link rel="import" href="beer-icons.html">
<link rel="import" href="beer-pub-card.html">
<link rel="import" href="beer-login.html">


<!--<link rel="import" href="beer-home-search.html">-->



<dom-module id="beer-account">

  <template>

    <style include="beer-button">


     .card {
        padding: 12px;
        margin: 10px;
    }

    .card-header {
        @apply(--layout-horizontal);
        @apply(--layout-justified);
        font-size: .9rem;
        font-weight: 400;
     }


      wrapper{
         @apply(--layout-horizontal);
         @apply(--layout-wrap);
      }

      .item {
        margin: 30px;
        padding: 10px;
        @apply(--layout-horizontal);
        @apply(--layout-center-justified);
      }

  


      .motto {
        font-size: 2.0em;
        font-weight: 500;
        margin: 20px 5px 0 20px;
      }


      .history {
        font-size: 1.2em;
        font-weight: 300;
        margin: 10px 5px 0 20px;
      }



    </style>

     <firebase-auth id="auth"  app-name="beer" user="{{user}}"></firebase-auth>

    <firebase-query
        id="organization"
        app-name="beer"
        order-by-child="domain";
        equal-to="[[userData.domain]]"
        disabled
        path="organization"
        data="{{organizations}}">
    </firebase-query>

    <firebase-document
        app-name="beer"
        id="userData"
        disabled
        path="user/[[user.uid]]"
        data="{{userData}}">
    </firebase-document>

    

    <iron-media-query query="max-width: 767px" query-matches="{{smallScreen}}"></iron-media-query>



<!--[[_test(testing)]]-->
    <!--[[_test(ratings)]]-->
    
    <beer-fab owner="[[owner]]" on-tap="_edit"></beer-fab>
    <!--<iron-image 
        style="width:100%; height:300px; background-color: #F8F8F8;"
        sizing="cover" 
        preload 
        fade
        src="[[organization.mainImage.banner.url]]">
    </iron-image>-->

     <div class="body">
          <!--<div class="motto">
            [[organization.motto]]
          </div>
          <div class="history">
            [[organization.history]]
          </div>-->
          
          <div hidden$="[[user]]">
            
             <beer-login class="item"></beer-login>
          </div>


 
          <div hidden$="[[!user]]">
            <paper-material class="card" elevation="0">
           
            
            <!--Account Details
            <div>Domain: [[userData.domain]]</div>
            <div>Name: [[userData.displayName]]</div>
            <div>Admin: [[userData.ADMIN]]</div>
            <div>Email Verified: [[user.emailVerified]]</div>-->

            <div hidden$="[[!userData.ADMIN]]">
              You are an administrator and may edit any data.
            </div>
           
            <div hidden$="[[user.emailVerified]]">
              You cannot save or edit information because your emial has not been verified by [[provider]].
            </div>
            <div hidden$="[[!user.emailVerified]]">
              You may edit comment and rating data associated with the account "[[user.email]]".
              <div hidden$="[[!userData.domain]]">
                Also, you may edit organization data sharing the domain "[[userData.domain]]".
                 
                  <template is="dom-repeat" items="[[organizations]]" as="pub">

                    <beer-pub-card 
                        place-id="[[pub.place_id]]"
                        name="[[pub.name]]"
                        motto="[[pub.motto]]"
                        city="[[pub.city]]"
                        state="[[pub.state]]"
                        dog-friendly="[[pub.dogFriendly]]"
                        patio="[[pub.patio]]"
                        over21="[[pub.over21]]">
                    </beer-pub-card>
                    
            
                   </template>

              </div>
            </div>
            </paper-material>
          </div>
     

      <div class="wrapper">
          
          <template is="dom-if" if="[[!smallScreen]]">
            <div class="item">
              <beer-button>
                <a aria-label="Near me" href="/home/near">
                  <iron-icon icon="beer-icons:gps-fixed"></iron-icon>Near Me</a>
              </beer-button>
            </div>
            <div class="item">
              <beer-button>
                <a aria-label="Seach" href="/home/search">
                  <iron-icon icon="beer-icons:search"></iron-icon>Search</a>
              </beer-button>
            </div>
            <div class="item">
              <beer-button>
                <a aria-label="Favorites" href="/home/favorites">
                <iron-icon icon="beer-icons:favorite"></iron-icon>My Favorites</a>
              </beer-button>
            </div>
            <div class="item" >
              <beer-button>
                <a  aria-label="Browse" href="/home/browse">
                  <iron-icon icon="beer-icons:near-me"></iron-icon>Browse</a>
              </beer-button>
            </div>

             <div class="item" >
              <beer-button>
                <a on-tap="_logout" aria-label="Sign out">
                  <iron-icon icon="beer-icons:account"></iron-icon>Sign out
                  </a>
              </beer-button>
            </div>
            
          </template>
           
      </div>

          
     

     </div>


      <paper-dialog 
        id="editDialog"
        with-backdrop
        style="width: 90vw;"
        entry-animation="slide-from-right-animation"
        exit-animation="slide-right-animation">
      
     
        <paper-dialog-scrollable>
          

          <h3>Upload Images</h3>
          <upload-image org-id="home" type="banner" key="mainImage"></upload-image>
        
          
          <h3>Basic Information</h3>
          <paper-input label="Motto" value="{{organization.motto}}"maxlength=100 char-counter></paper-input>
          <paper-textarea label="History" value="{{organization.description}}" maxlength=2000 char-counter></paper-textarea>
          
          
          </div>
          
        </paper-dialog-scrollable>


      <div>
        <paper-button dialog-dismiss autofocus>CLOSE</paper-button>
      </div>
    </paper-dialog>

</template>
  <script>

    Polymer({

      is: 'beer-account',

      properties: {

        organizations:{
          type: Array
        },

        user:{
          type: Object
        },

        provider: {
          type: String,
          computed: '_computeProvider(user)'

        },

      },

 

      observers:['_watchUserStatus(user)'],

      _watchUserStatus: function (user) {
        
        if(user){
          this.$.userData.disabled = false;
          this.$.organization.disabled = false;
          
        }else{
          this.$.userData.disabled = true;
          this.$.organization.disabled = true;
        }
      },

    


      _computeProvider: function (user){
        if(user){
          var provider = user.providerData[0];
          return provider.providerId;
        }else{
          return 'your provider'
        }

      },

      
      _computedOwnsOrganizations: function (){
        var organizations = this.$.organizations
        return !organizations.valueIsEmpty(organizations);
      },

      _edit: function(){
        'use strict';
        var body = document.querySelector('body');
        Polymer.dom(body).appendChild(this.$.editDialog);
        this.$.editDialog.open()
      },
       
      // login: function(){
      //   'use strict';
      //   this.$.loginDialog.open();
      // },

      // _addPub: function () {
      //   var query = this.$.organizations;
      //   var org = {};
      //   org.PUB = true;
      //   org.category = {}

      //   org.category.BEER = {};
      //   org.category.BEER.name = 'beer';
      //   org.category.BEER.title = 'Beer';
      //   org.category.BEER.order = '1';
      //   org.category.BEER.display = false;

      //   org.category.MENU = {};
      //   org.category.MENU.name = 'menu';
      //   org.category.MENU.title = 'Menu';
      //   org.category.MENU.order = '2';
      //   org.category.MENU.display = false;

      //   org.category.TRUCK = {};
      //   org.category.TRUCK.name = 'truck';
      //   org.category.TRUCK.title = 'Food Truck';
      //   org.category.TRUCK.order = '3';
      //   org.category.TRUCK.display = false;

      //   org.category.CONTACT = {};
      //   org.category.CONTACT.name = 'contact';
      //   org.category.CONTACT.title = 'Contact';
      //   org.category.CONTACT.order = '4';
      //   org.category.CONTACT.display = false;

      //   org.category.EVENT = {};
      //   org.category.EVENT.name = 'event';
      //   org.category.EVENT.title = 'Event';
      //   org.category.EVENT.order = '5';
      //   org.category.EVENT.display = false;

      //   org.category.STORE = {};
      //   org.category.STORE.name = 'store';
      //   org.category.STORE.title = 'Store';
      //   org.category.STORE.order = '6';
      //   org.category.STORE.display = false;

      //   org.uid = 'test';
      //   org.name = 'New Pub'
      //   query.ref.push(org);
      // },

      // _addTruck(){
      //   var query = this.$.organizations;
      //   var org = {};
      //   org.TRUCK = true;
      //   org.category = {}

      //   org.category.MENU = {};
      //   org.category.MENU.name = 'menu';
      //   org.category.MENU.title = 'Menu';
      //   org.category.MENU.order = '1';
      //   org.category.BEER.display = false;

      //   org.category.LOCATION = {};
      //   org.category.LOCATION.name = 'location';
      //   org.category.LOCATION.title = 'Location';
      //   org.category.LOCATION.order = '2';
      //   org.category.LOCATION.display = false;

      //   org.category.PUB = {};
      //   org.category.PUB.name = 'pub';
      //   org.category.PUB.title = 'PUB';
      //   org.category.PUB.order = '3';
      //   org.category.PUB.display = false;

      //   org.category.CONTACT = {};
      //   org.category.CONTACT.name = 'contact';
      //   org.category.CONTACT.title = 'Contact';
      //   org.category.CONTACT.order = '4';
      //   org.category.CONTACT.display = false;

      //   org.category.EVENT = {};
      //   org.category.EVENT.name = 'event';
      //   org.category.EVENT.title = 'Event';
      //   org.category.EVENT.order = '5';
      //   org.category.EVENT.display = false;

      //   org.category.STORE = {};
      //   org.category.STORE.name = 'store';
      //   org.category.STORE.title = 'Store';
      //   org.category.STORE.order = '6';
      //   org.category.STORE.display = false;

      //   org.uid = 'test';
      //   org.name = 'New Truck'
      //   query.ref.push(org);
      // },

      _logout: function(){
        'use strict';
        return this.$.auth.signOut();
      }, 

     

      _test: function(obj){
          console.log(obj);
      }

    });

  </script>

</dom-module>
