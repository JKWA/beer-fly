

<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/polymerfire/firebase-auth.html">
<link rel="import" href="../bower_components/paper-button/paper-button.html">
<link rel="import" href="../bower_components/paper-tabs/paper-tab.html">
<link rel="import" href="../bower_components/paper-tabs/paper-tabs.html">


<link rel="import" href="../bower_components/paper-input/paper-input.html">
<link rel="import" href="../bower_components/iron-icon/iron-icon.html">
<link rel="import" href="../bower_components/iron-collapse/iron-collapse.html">
<link rel="import" href="../bower_components/app-storage/app-localstorage/app-localstorage-document.html">


<link rel="import" href="beer-icons.html">





<dom-module id="beer-login">

  <template>

    <style>

   

    a{ 
        text-decoration: none;
        color: var(--app-accent-color);
    }


    .buttons{
        margin: 20px 0 0 0;
       
    }
    
    .buttons > div{
        
        @apply(--layout-horizontal);
        @apply(--layout-center-justified);
    }

    .error{
        color:red;
    }

    .wrapper{
        @apply(--layout-vertical);
        margin: 10px;
        /*padding: 10px;*/
        /*width: 300px;*/
    }

    paper-input{
        width: 220px;
    }

    

    .signInButton img{
        padding: 0 8px 0 2px;
        max-height: 15px;
    }
    .signInButton{
        width: 220px;
        text-align: left;
        margin-bottom: 15px;
        text-transform: none;
        min-height: 40px;
    }
    .signInButton.mini {
        width: 150px;
        margin: 20px 0 20px 0;
    }
    #googSignIn{
        background-color: white;
    }
    #fbSignIn{
        background-color: #3B5999;
        color: white;
    }
    
    #fbSignIn:hover{
        background-color: #4265b0;
    }

    .buttonIcon{
        width:15px; 
        height:15px; 
        padding: 0 8px 0 2px;
    }

    
    

    </style>

    <firebase-auth  id="auth" app-name="beer" user="{{user}}"></firebase-auth>
    <app-localstorage-document 
        key="loginEmail" 
        data="{{email}}">
    </app-localstorage-document>

    <paper-tabs selected="{{tabSelected}}">
        <paper-tab>Social</paper-tab>
        <paper-tab>Email</paper-tab>
    </paper-tabs>

    <div class="wrapper">

        <iron-collapse id="collapse" no-animation opened="{{!emailToggle}}">
            <div class="buttons">
            <div>
            <paper-button id="googSignIn" class$="signInButton" on-tap="_signInWithGoogle" raised>

                <div style="width:15px; height:15px; padding: 0 8px 0 2px;">
                    <svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
                        viewBox="0 0 123.3 126.2" style="enable-background:new 0 0 123.3 126.2;" xml:space="preserve">
                    <style type="text/css">
                        .st0{clip-path:url(#SVGID_2_);fill:#F9BC15;}
                        .st1{clip-path:url(#SVGID_4_);fill:#EA4535;}
                        .st2{clip-path:url(#SVGID_6_);fill:#36A852;}
                        .st3{clip-path:url(#SVGID_8_);fill:#557EBF;}
                    </style><g><g><defs>
                        <path id="SVGID_1_" d="M121.9,51.6h-7.2H91.2H63.1V76H97c-3.2,15.5-16.4,24.4-33.8,24.4c-20.7,0-37.3-16.6-37.3-37.3
                            s16.6-37.3,37.3-37.3c8.9,0,16.9,3.2,23.2,8.3l18.4-18.4C93.5,6,79.2,0,63.1,0C28.1,0,0,28.1,0,63.1s28.1,63.1,63.1,63.1
                            c31.6,0,60.2-22.9,60.2-63.1C123.3,59.4,122.8,55.4,121.9,51.6z"/>
                        </defs><clipPath id="SVGID_2_"><use xlink:href="#SVGID_1_" style="overflow:visible;"/></clipPath><polygon class="st0" points="-5.7,100.4 -5.7,25.8 43,63.1 "/></g><g><defs>
                        <path id="SVGID_3_" d="M121.9,51.6h-7.2H91.2H63.1V76H97c-3.2,15.5-16.4,24.4-33.8,24.4c-20.7,0-37.3-16.6-37.3-37.3
                            s16.6-37.3,37.3-37.3c8.9,0,16.9,3.2,23.2,8.3l18.4-18.4C93.5,6,79.2,0,63.1,0C28.1,0,0,28.1,0,63.1s28.1,63.1,63.1,63.1
                            c31.6,0,60.2-22.9,60.2-63.1C123.3,59.4,122.8,55.4,121.9,51.6z"/>
                        </defs><clipPath id="SVGID_4_"><use xlink:href="#SVGID_3_" style="overflow:visible;"/></clipPath><polygon class="st1" points="-5.7,25.8 43,63.1 63.1,45.6 132,34.4 132,-5.7 -5.7,-5.7"/></g><g><defs>
                        <path id="SVGID_5_" d="M121.9,51.6h-7.2H91.2H63.1V76H97c-3.2,15.5-16.4,24.4-33.8,24.4c-20.7,0-37.3-16.6-37.3-37.3
                            s16.6-37.3,37.3-37.3c8.9,0,16.9,3.2,23.2,8.3l18.4-18.4C93.5,6,79.2,0,63.1,0C28.1,0,0,28.1,0,63.1s28.1,63.1,63.1,63.1
                            c31.6,0,60.2-22.9,60.2-63.1C123.3,59.4,122.8,55.4,121.9,51.6z"/>
                        </defs><clipPath id="SVGID_6_"><use xlink:href="#SVGID_5_"  style="overflow:visible;"/></clipPath><polygon class="st2" points="-5.7,100.4 80.3,34.4 103,37.3 132,-5.7 132,132 -5.7,132"/></g><g><defs>
                            <path id="SVGID_7_" d="M121.9,51.6h-7.2H91.2H63.1V76H97c-3.2,15.5-16.4,24.4-33.8,24.4c-20.7,0-37.3-16.6-37.3-37.3
                            s16.6-37.3,37.3-37.3c8.9,0,16.9,3.2,23.2,8.3l18.4-18.4C93.5,6,79.2,0,63.1,0C28.1,0,0,28.1,0,63.1s28.1,63.1,63.1,63.1
                            c31.6,0,60.2-22.9,60.2-63.1C123.3,59.4,122.8,55.4,121.9,51.6z"/>
                        </defs><clipPath id="SVGID_8_"><use xlink:href="#SVGID_7_"  style="overflow:visible;"/></clipPath><polygon class="st3" points="132,132 43,63.1 31.6,54.5 132,25.8"/></g></g>
                    </svg>
                </div>
                {{_getButtonText()}}Google</paper-button>
            </div>

            <div>
                <paper-button id="fbSignIn" class$="signInButton" on-tap="_signinWithFacebook" raised>
                <div style="width:15px; height:15px">
                    <svg viewBox="0 0 7.94 16.74" style="height:15px;fill:white;">
                        <path d="M5.39,16.79H2.29V8.52H0.22V5.67H2.29V4c0-2.32.63-3.74,3.37-3.74H7.94V3.1H6.51c-1.07,0-1.12.4-1.12,1.14V5.67H8L7.65,8.52H5.39v8.27Z" transform="translate(-0.12 -0.15)" style="stroke:#000;stroke-miterlimit:10;stroke-width:0.20000000298023224px"/>
                    </svg>
                </div>
                {{_getButtonText()}}Facebook</paper-button>
            </div>
            </div>
        </iron-collapse>


     <iron-collapse id="collapse" no-animation opened="{{emailToggle}}">
      
      <form>
    
        <div class="email">
            <div>
            <paper-input 
                type="email" 
                label="Email"
                validator="email-validator" 
                error-message="Invalid email address" 
                required 
                auto-validate
                value="{{email}}">
            </paper-input>
            </div>
            <div>
                <paper-input 
                    type="password" 
                    label="Password"
                    required
                    on-keydown="_watchForSubmit"
                    value="{{password}}">
                </paper-input>
            <div>

            <div class="buttons">
                <div>
                    <paper-button class="signInButton" on-tap="_signInEmail" raised>Sign In</paper-button>
                </div>
                <div>
                    <paper-button class="signInButton" on-tap="_signUpEmail" raised>Create New Account</paper-button>
                </div>
            </div>

            <!--<div>You will need to verify your email.</div>-->

            <div class="error">[[message]]</div>

            <div id="passwordResetMessage" hidden>
                <a href="#" id="reset" on-click="_resetPassword">Reset password for [[email]]</a>
            </div>
            
        </div>
      </form>
    </iron-collapse>  
    
    </div>
    

</template>
  <script>

    Polymer({

      is: 'beer-login',

      properties: {
        user:{
            type: Object
        },

        email:{
            type: String
        },

        emailToggle:{
            type: Boolean,
            value: false
        },

        tabSelected:{
            type: Number,
            value:0
        },

        message:{
            type:String
        },

        password:{
            type:String
        },

        login:{
            type:Boolean,
            notify: true
        }
        
       
      },

      observers:['_watchTabChange(tabSelected)'],

      _watchTabChange: function (tabSelected){
        if(tabSelected === 1){
            this.emailToggle = true;
        }else{
            this.emailToggle = false;
        }
      },


    _getMiniClass: function(){
      return this.mini ? "mini" : "";
    },

    _getButtonText: function(a){
      if(this.mini){
          return a == "anon" ? "Anonymously" : "";
      } else {
          return a == "anon" ? "Sign in anonymously" : "Sign in with ";
      }
    },

    _signInWithGoogle: function(){
        this.$.auth.signInWithRedirect('google')
        .then(function(response) {
            console.log("signed in")
        })
        .catch(function(error) {
          console.log('error', error)
        });

    },

    _signinWithFacebook: function(){
        this.$.auth.signInWithRedirect('facebook')
        .then(function(response) {
            console.log("signed in")
        })
        .catch(function(error) {
          console.log('error', error)
        });

    },

     _watchForSubmit: function (event){
         var key = event.which || event.keyCode;
         if(key === 13){
           this._signInEmail();
         }
      },

    _signInEmail: function(){
        // this._cleanMessages();
        var that = this;
        this.message = '';
        that.$.passwordResetMessage.hidden = true;

        this.$.auth.signInWithEmailAndPassword(this.email, this.password)
         .then(function(response) {
            console.log("signed in")
        })
        .catch(function(error) {
          console.log('error', JSON.stringify(error))

          if(error.code === 'auth/user-not-found'){
              that.message = 'There is no account for this email';
          }else if(error.code === 'auth/wrong-password'){
              that.message = 'Incorrect password';
              that.$.passwordResetMessage.hidden = false;
          }else{
              that.message = error.message;
          }
        });
      },

      _signUpEmail: function(){
        var that = this;
        this.message = '';
        this.$.auth.createUserWithEmailAndPassword(this.email, this.password)
         .then(function(response) {
            console.log("signed in")
        })
        .catch(function(error) {
            console.log('error', JSON.stringify(error))
            that.message = error.message;
          
        });
      },

       _resetPassword: function () {

        var that = this;
        this.message = '';
        if(this.email){
          this.$.auth.sendPasswordResetEmail(this.email)
            .then(function () {
                console.log('password sent');
                that.message = 'Password reset link sent to '+that.email;
                that.$.passwordResetMessage.hidden = true;
            })
            .catch(function(error){
                console.log('error', JSON.stringify(error))
                that.message = error.message
               
            })
        }else{
            this.message = 'Add valid email address.'
        }
                   
      },

    _showEmailSignin: function (){
        this.emailToggle = !this.emailToggle;
    },
      
     

      _test: function(obj){
          console.log(obj);
      }

    });

  </script>

</dom-module>
