<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/polymerfire/firebase-app.html">
<link rel="import" href="../bower_components/geo-location/geo-location.html">
<link rel="import" href="../bower_components/geofire-elements/geofire-query.html">
<link rel="import" href="../bower_components/s-slider/s-slider.html">


<link rel="import" href="beer-allbreweries-card.html">

<dom-module id="beer-allbreweries">

  <template>

    <style>
    .body {
      height: 100vh;
      margin: 0;
      display: flex;
      flex-direction: column;
    }
    

      .distance-wrapper {
        color: var(--app-secondary-color);
        margin: 40px 5px 0 20px;
      }

      .distance {
        color: var(--app-secondary-color);
        font-size: 1.2em;
        font-weight: 300;
      }

    </style>

 
    <firebase-app 
        id="fire_DB" 
        name="beer" 
        api-key="AIzaSyD2Z_cYgNuKB58bGbSzo0kMmJAWj0A0p18" 
        auth-domain="beer-fly.firebaseapp.com"
        database-url="https://beer-fly.firebaseio.com" 
        storage-bucket="beer-fly.appspot.com">
    </firebase-app>

    <geo-location 
        latitude="{{lat}}" 
        longitude="{{lng}}">
    </geo-location>


    <geofire-query 
        id="query" 
        app="beer" 
         path="GeoFire"
        lat="[[lat]]" 
        lng="[[lng]]" 
        radius="[[distance]]" 
        results-array="{{breweries}}">
    </geofire-query>


    <div class="distance-wrapper">
      <s-slider value="{{sliderDistance}}"></s-slider>
      <div class="distance">Within [[distance]] miles</div>
    </div>
   
    <template is="dom-repeat" items="[[breweries]]" as="geo" sort="_sortByDistance">
        <beer-allbreweries-card place-id ="[[geo.key]]" distance="[[geo.distance]]">
        </beer-allbreweries-card>
    </template>


  </template>

  <script>

    Polymer({

      is: 'beer-allbreweries',

        properties: {

        distance:{
          type: Number,
          value: 5
        },
        sliderDistance:{
          type: Number,
          value: 10
        }
       },
       observers: ['_observeSliderDistance(sliderDistance)'],
     _computeSliderDistanceValue: function (distance){
       return distance*10
     },

     _observeSliderDistance:function (sliderDistance){
      //  console.log(sliderDistance);
       this.distance = sliderDistance/2;
     },
    
      _test: function (obj) {
        console.log(obj);
      },
  
      _sortByDistance: function(a,b){
        'use strict';
        if (a.distance < b.distance)
          return -1;
        if (a.distance > b.distance)
          return 1;
        return 0;
      },


    });

  </script>

</dom-module>
